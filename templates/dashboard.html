{% extends 'base.html' %}
{% block content %}
  <div id="root"></div>
{% endblock %}
{% block scripts %}
{% raw %}
<script type="text/babel">
  const { useState, useEffect } = React;

  function ChallengeModal({ isOpen, onClose, challenge }) {
    if (!isOpen) return null;
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div className="w-full max-w-sm bg-yellow-400 text-black rounded-xl shadow-lg">
          <div className="p-6">
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-2 font-semibold"><i data-lucide="trophy" className="w-6 h-6"></i> Challenge</div>
              <button className="p-2 rounded hover:bg-black/10" onClick={onClose}>
                <i data-lucide="x" className="w-4 h-4"></i>
              </button>
            </div>

            <h3 className="text-xl font-bold mb-2">{challenge.title}</h3>
            <p className="text-sm mb-4">{challenge.description}</p>

            <div className="flex items-center justify-between mb-6 text-sm">
              <span className="font-semibold">Earn: {challenge.points} points</span>
              <span className="font-semibold">Time: {challenge.timeLimit}</span>
            </div>

            <div className="space-y-3">
              <button className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-md">Accept Challenge</button>
              <button className="w-full border border-black/20 bg-transparent py-2 rounded-md" onClick={onClose}>Maybe Later</button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  function Dashboard() {
    const [user, setUser] = useState(null);
    const [timeToNextRound, setTimeToNextRound] = useState(7 * 60);
    const [showChallenge, setShowChallenge] = useState(false);

    const challenge = {
      title: "Network Challenge!",
      description: "Talk to 3 designers in 20 minutes and discover their favorite design tools!",
      points: 50,
      timeLimit: "20 mins",
    };

    useEffect(() => {
      const userData = localStorage.getItem('ramble_user');
      if (userData) {
        setUser(JSON.parse(userData));
      } else {
        window.location.assign('/');
      }
      const showTimer = setTimeout(() => setShowChallenge(true), 3000);
      return () => clearTimeout(showTimer);
    }, []);

    useEffect(() => {
      const timer = setInterval(() => {
        setTimeToNextRound(prev => (prev > 0 ? prev - 1 : 0));
      }, 1000);
      return () => clearInterval(timer);
    }, []);

    useEffect(() => {
      if (window.lucide) window.lucide.createIcons();
    });

    const formatTime = (seconds) => {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    };

    const topRamblers = [
      { name: 'Sarah M.', points: 2880, initial: 'S' },
      { name: 'Mike R.', points: 2720, initial: 'M' },
      { name: 'Qelvin N.', points: 6900, initial: 'Q' },
      { name: 'Rick C.', points: 4200, initial: 'R' },
      { name: 'Marwin G.', points: 2690, initial: 'M' },
    ];

    const upcomingRounds = [
      { name: 'No-Code Builders', time: '45 mins' },
      { name: 'Crypto Enthusiast', time: '2 hours' },
    ];

    if (!user) return null;

    return (
      <div className="min-h-screen bg-gray-50">
        {/* Header */}
        <div className="bg-blue-900 text-white p-4 text-center">
          <div className="flex items-center justify-center gap-2 mb-2">
            <span>ðŸ‘‹</span>
            <span className="font-semibold">Hi, {user.name}!</span>
          </div>
          <div className="text-sm opacity-90">Your first round starts in {formatTime(timeToNextRound)}</div>
        </div>

        <div className="p-4 space-y-4">
          {/* Event Card */}
          <div className="p-4 bg-white rounded-xl border">
            <div className="flex items-center justify-between mb-4">
              <div>
                <h2 className="font-bold text-lg">AI Innovators</h2>
                <div className="flex items-center gap-2 text-sm text-gray-600">
                  <i data-lucide="users" className="w-4 h-4"></i>
                  <span>4/6 Rams</span>
                  <i data-lucide="clock" className="w-4 h-4 ml-2"></i>
                  <span>{formatTime(timeToNextRound)}</span>
                </div>
              </div>
              <div className="flex -space-x-2">
                {["S","M","A","J","C","Y"].map((initial, i) => (
                  <div key={i} className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium text-white ${['bg-pink-400','bg-blue-400','bg-green-400','bg-purple-400','bg-orange-400','bg-yellow-400'][i]}`}>
                    {initial}
                  </div>
                ))}
              </div>
            </div>
            <button className="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-3 rounded-md" onClick={() => window.location.assign('/quiz')}>Join Now! âš¡</button>
          </div>

          {/* Stats Cards */}
          <div className="grid grid-cols-2 gap-4">
            <div className="p-4 text-center bg-white rounded-xl border">
              <i data-lucide="trophy" className="w-6 h-6 mx-auto mb-2 text-orange-500"></i>
              <div className="text-2xl font-bold">#{user.rank}</div>
              <div className="text-sm text-gray-600">This week</div>
            </div>
            <div className="p-4 text-center bg-white rounded-xl border">
              <div className="text-2xl font-bold text-orange-500">{user.points.toLocaleString()}</div>
              <div className="text-sm text-gray-600">Ram Points</div>
            </div>
          </div>

          {/* Top RAMblers */}
          <div className="p-4 bg-white rounded-xl border">
            <div className="flex items-center justify-between mb-4">
              <h3 className="font-semibold">Top RAMblers</h3>
              <button className="text-blue-600 text-sm px-2 py-1 rounded hover:bg-blue-50">View All</button>
            </div>
            <div className="space-y-3">
              {topRamblers.slice(0,3).map((rambler, index) => (
                <div key={index} className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium ${['bg-pink-400','bg-blue-400','bg-green-400'][index]}`}>{rambler.initial}</div>
                    <span className="font-medium">{rambler.name}</span>
                  </div>
                  <span className="font-semibold">{rambler.points.toLocaleString()}</span>
                </div>
              ))}
            </div>
          </div>

          {/* Upcoming Rounds */}
          <div className="p-4 bg-white rounded-xl border">
            <h3 className="font-semibold mb-4">Upcoming Rounds</h3>
            <div className="space-y-3">
              {upcomingRounds.map((round, index) => (
                <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <span className="font-medium">{round.name}</span>
                  <span className="text-sm text-gray-600">{round.time}</span>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Bottom Navigation */}
        <div className="fixed bottom-0 left-0 right-0 bg-yellow-400 p-2">
          <div className="flex justify-around items-center">
            <button className="flex flex-col items-center gap-1 text-black p-2 rounded hover:bg-black/10">
              <i data-lucide="home" className="w-5 h-5"></i>
              <span className="text-xs">HOME</span>
            </button>
            <button className="flex flex-col items-center gap-1 text-black p-2 rounded hover:bg-black/10" onClick={() => window.location.assign('/groups')}>
              <i data-lucide="users" className="w-5 h-5"></i>
              <span className="text-xs">GROUPS</span>
            </button>
            <button className="flex flex-col items-center gap-1 text-black p-2 rounded hover:bg-black/10" onClick={() => window.location.assign('/leaderboard')}>
              <i data-lucide="trophy" className="w-5 h-5"></i>
              <span className="text-xs">BOARD</span>
            </button>
            <button className="flex flex-col items-center gap-1 text-black p-2 rounded hover:bg-black/10" onClick={() => window.location.assign('/profile')}>
              <i data-lucide="message-circle" className="w-5 h-5"></i>
              <span className="text-xs">PROFILE</span>
            </button>
          </div>
        </div>

        <ChallengeModal isOpen={showChallenge} onClose={() => setShowChallenge(false)} challenge={challenge} />
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<Dashboard/>);
</script>
{% endraw %}
{% endblock %}
